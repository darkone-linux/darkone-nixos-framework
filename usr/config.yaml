# Nix generator

formatter: "nixfmt"

#------------------------------------------------------------------------------
# Nix default.nix generations (wip)
#------------------------------------------------------------------------------

default:
    modules:
        - name: "DNF Modules directory"
          directory: "lib/modules"
          recursive: true
    overlays:
        - name: "DNF Overlays directory"
          directory: "lib/overlays"
          recursive: true

#------------------------------------------------------------------------------
# Nix DNF hosts from LLDAP (wip)
# Contains users and groups
# users <-> groups <-> hosts
#------------------------------------------------------------------------------

hostProvider:
    lldap:

        # Use nsswitch to login users, otherwise user configurations are
        # generated in the nix configuration
        #nss: false # Not implemented yet
        url: "ldap://localhost:3890"
        bind:
            user: "admin"
            passwordFile: "usr/secrets/lldap"

#------------------------------------------------------------------------------
# Nix DNF static hosts (nested hosts.<type>) (wip)
#------------------------------------------------------------------------------

# Static users
# -> profile is HomeManager profile
# -> groups is used to select related hosts
users:

    darkone:
        name: "Darkone Linux"
        email: "darkone@darkone.yt"
        profile: "admin"
        groups: [ "trainers", "employes" ]
    john:
        name: "John Doe"
        email: "john@doe.fr"
        profile: "office"
        groups: [ "students" ]

# Hosts declaration
# -> users are explicit users
# -> groups are used to select related users
#    and add colmena tags
hosts:

    # Static hosts
    static:

        # A simple host
        - hostname: "nlt"
          name: "Darkone Laptop"
          users: [ "darkone" ]
          groups: [ "laptop", "admin", "local" ]
          colmena:
              deployment:
                  tags: [ "laptop", "admin", "local" ]
              allowLocalDeployment: true

    # Host groups by range
    range:

        # 3 hosts vbox-01, vbox-02 and vbox-03
        - hostname: "vbox-%'02s"
          name: "Virtual %'02s"
          range: [ 1, 3 ]
          users: [ "darkone", "john" ]
          colmena: { deployment: { tags: [ "test" ] } }

    # Host groups by list of hostnames
    list:

        # 3 hosts lea, tom and bob
        - hostname: "%s"
          name: "Training machine of %s"
          hosts:
              lea: "Lea"
              tom: "Tom"
              bob: "Bob"
          groups: [ "trainers", "students" ]
          colmena: { deployment: { tags: [ "training", "test" ] } }

    # 2 hosts patrick and john
        - hostname: "%s"
          name: "Workstation of %s"
          hosts:
              patrick: "Patrick Dupont"
              john: "John Doe"
          groups: [ "employes" ]
          colmena: { deployment: { tags: [ "employes" ] } }
