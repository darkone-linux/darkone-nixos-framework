# Nix generator configuration file for Darkone NixOS Framework (common file)

# Minimal network with gateway
# network:
#   gateway:
#     hostname: "agate" # required, existing host
#     wan:
#       interface: "eth0" # required
#     lan:
#       interface: "enu1u4" # required

# Global network configuration is converted in lists / attSets to be used in
# your nix configuration through "network" special arg.
network:
  domain: "darkone.lan" # required
  locale: "fr_FR.UTF-8"
  timezone: "America/Miquelon"
  gateway:
    hostname: "gateway" # required (if gateway key exists)
    wan:
      interface: "eth0" # required
    lan:
      interfaces: ["enu1u4"] # required
      ip: "192.168.1.1"
      prefixLength: 24
      dhcp-range:
        - "192.168.1.100,192.168.1.230,24h"
      #dhcp-extra-option: # option
      #  - "option:ntp-server,191.168.1.1"
  #extraHosts:
  #  tablet:
  #    interfaces:
  #      - ip: "192.168.1.104"
  #        mac: "30:56:84:11:d1:79"
  #  alice:
  #    aliases: ["alicia"]
  #    interfaces:
  #      - ip: "192.168.0.144"
  #        mac: "30:56:84:11:d1:01,30:56:84:11:d1:02"

#------------------------------------------------------------------------------
# Nix DNF static hosts (nested hosts.<type>)
#------------------------------------------------------------------------------

# Static users
# -> profile is the HomeManager profile
# -> groups is used to select related hosts
users:

  # An admin user
  darkone:
    uid: 1000
    name: "Darkone Linux"
    email: "darkone@darkone.yt"
    profile: "darkone"
    groups: ["common", "admin"]

  # A regular user
  alice:
    uid: 1001
    name: "Alice"
    profile: "normal"
    groups: ["common"]

# Hosts declaration
# -> name: human readable name or description
# -> profile: the host profile related to this host
# -> users: a list of existing user logins
# -> groups: used to select related users
# -> tags: added to colmena tags for deployment filtering
# -> local: true is only for the local (master) machine
# -> arch: the host architecture, default is x86_64-linux
# -> disko: disks description for an auto-install with disko (only for install)
# -> interfaces: list of ips + mac addresses (fixed adresses)
# -> services: enabled DNF services on this hosts
hosts:

  # Static hosts
  static:

    # The gateway
    - hostname: "gateway"
      name: "Local Gateway"
      arch: "aarch64-linux"
      profile: "gateway"
      groups: ["admin"]
      aliases: ["gateway", "passerelle"]
      services:
        homepage:
        ncps:
        forgejo:
          title: "Our local forge"
        adguardhome:
        monitoring:

    # A laptop
    - hostname: "my-laptop"
      name: "My Laptop"
      profile: "admin-laptop"
      users: ["darkone"]
      groups: ["admin", "common"]
      tags: ["laptops", "admin"]
      arch: "x86_64-linux" # default
      interfaces:
        - mac: "f0:1f:af:13:62:a5,bc:85:56:25:b8:45"
          ip: "192.168.1.3"
      services:
        homepage:
          domain: "nlt-home"
        immich:
          title: "Local pictures"
          description: "Our pictures and videos"
          domain: "medias"
          icon: "google-photos"
        nextcloud:
          domain: "nlt-nextcloud"
          title: "Our local cloud"
          description: "A nextcloud instance"
      disko:
        profile: "btrfs-1-disk"
        devices:
          main: "/dev/nvme0n1"

  # Host groups by range (generated from min to max)
  range:

    # Virtualbox hosts for tests
    - hostname: "vbox-%'02s"
      name: "Virtual %'02s"
      profile: "vbox"
      range: [1, 4]
      tags: ["vm", "vbox"]
      users: []
      #disko:
      #  profile: "vm"
      #   devices:
      #     main: "/dev/sda"
      #hosts:
      #  1:
      #    interfaces:
      #      - mac: "08:00:27:03:BB:20"
      #        ip: "192.168.1.81"
      #  2:
      #    interfaces:
      #      - mac: "08:00:27:AE:49:7F"
      #        ip: "192.168.1.82"
      #  3:
      #    interfaces:
      #      - mac: "08:00:27:f1:e9:9a"
      #        ip: "192.168.1.83"
      #  4:
      #    interfaces:
      #      - mac: "08:00:27:A4:B1:36"
      #        ip: "192.168.1.84"

  # Host groups by list of hostnames
  list:
    - hostname: "%s-laptop" # optional
      name: "Laptop %s" # optional
      profile: "local-laptop"
      hosts:
        kids:
          name: "Kids"
          interfaces:
            - mac: "f0:1f:af:13:61:c6"
              ip: "192.168.1.20"
      groups: ["common"]
      users: ["darkone"]

#------------------------------------------------------------------------------
# Nix DNF hosts from LLDAP (deprecated)
# Contains users and groups
# users <-> groups <-> hosts
#------------------------------------------------------------------------------

hostProvider:
  lldap:
    enabled: false

    # Use nsswitch to login users, otherwise user configurations are
    # generated in the nix configuration
    #nss: false # Not implemented yet
    url: "ldap://localhost:3890"
    bind:
      user: "admin"
      passwordFile: "lldap" # located in usr/secrets
