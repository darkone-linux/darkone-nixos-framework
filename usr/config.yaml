# Nix generator configuration file for Darkone NixOS Framework (common file)

# Global network configuration is converted in lists / attSets to be used in 
# your nix configuration through "networks.<network>" or "network" special arg.
networks:

  # The default network
  default:
    domain: "arthur.lan"
    gateway:
      hostname: "gateway"
      ip: "192.168.0.1"

#------------------------------------------------------------------------------
# Nix DNF static hosts (nested hosts.<type>)
#------------------------------------------------------------------------------

# Static users
# -> profile is the HomeManager profile
# -> groups is used to select related hosts
users:

  # Darkone
  darkone:
    uid: 1000
    name: "Darkone Linux"
    email: "darkone@darkone.yt"
    profile: "darkone"
    groups: [ "admin" ]

  # Arthur
  anso:
    uid: 1002
    name: "Anso"
    profile: "normal"
    groups: [ "common" ]
  charlie:
    uid: 1003
    name: "Charlie"
    profile: "teenager"
    groups: [ "kids", "common" ]
  axelle:
    uid: 1004
    name: "Axelle"
    profile: "children"
    groups: [ "kids", "common" ]
  tristan:
    uid: 1005
    name: "Tristan"
    profile: "baby"
    groups: [ "kids", "common" ]

# Hosts declaration
# -> name: human readable name or description
# -> profile: the host profile related to this host
# -> users: a list of existing user logins
# -> groups: used to select related users
# -> networks: the first one is the default (to auto-generate email for example)
# -> tags: added to colmena tags for deployment filtering.
# -> local: true is only for the local (master) machine.
hosts:

  # Static hosts
  static:

    # Darkone (multi-network)
#    - hostname: "nlt"
#      name: "Darkone Laptop"
#      profile: "admin-laptop"
#      users: [ "darkone" ]
#      groups: [ "admin", "common" ]
#      networks: [ "default", "sn" ]
#      tags: [ "laptops", "admin" ]
#      local: true

    # Default network
    # NOTE: if no "networks" is specified, hosts are linked to "default" network
#    - hostname: "gateway"
#      name: "Home Gateway & HomeLab"
#      profile: "gateway"
#      groups: [ "admin" ]
#    - hostname: "charlie"
#      name: "Cle USB Charlie"
#      profile: "child-key"
#      users: [ "charlie" ]
#    - hostname: "axelle"
#      name: "Cle USB Axelle"
#      profile: "child-key"
#      users: [ "axelle" ]

    # Test key
    - hostname: "test-key"
      name: "Test key"
      profile: "portable"
      groups: [ "common" ]

  # Host groups by range (generated from min to max)
  range:

    # Virtualbox hosts for tests
    - hostname: "vbox-%'02s"
      name: "Virtual %'02s"
      profile: "vbox"
      range: [ 1, 4 ]
      groups: [ "common" ]
      tags: [ "vbox" ]

  # Host groups by list of hostnames
  list:

    - hostname: "%s-laptop" # optional
      name: "Ordi portable %s" # optional
      profile: "laptop"
      hosts:
        kids: "Kids"
      groups: [ "common" ]
      users: [ "darkone" ]

#------------------------------------------------------------------------------
# Nix DNF hosts from LLDAP (wip)
# Contains users and groups
# users <-> groups <-> hosts
#------------------------------------------------------------------------------

hostProvider:
  lldap:
    enabled: false

    # Use nsswitch to login users, otherwise user configurations are
    # generated in the nix configuration
    #nss: false # Not implemented yet
    url: "ldap://localhost:3890"
    bind:
      user: "admin"
      passwordFile: "lldap" # located in usr/secrets
